(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{369:function(t,s){t.exports="data:image/png;base64,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"},370:function(t,s,a){t.exports=a.p+"assets/img/effect-list-demo1.cc5cac87.png"},371:function(t,s,a){t.exports=a.p+"assets/img/effect-list-demo2.c1a64f7b.png"},372:function(t,s,a){t.exports=a.p+"assets/img/effect-list-demo3.df0c4aec.png"},373:function(t,s,a){t.exports=a.p+"assets/img/effect-list-demo4.54b73392.png"},387:function(t,s,a){"use strict";a.r(s);var n=a(26),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"冒泡阶段"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#冒泡阶段"}},[t._v("#")]),t._v(" 冒泡阶段")]),t._v(" "),n("p",[t._v("冒泡阶段的起始函数是"),n("code",[t._v("completeUnitOfWork")]),t._v("。")]),t._v(" "),n("p",[t._v("在上一章我们知道了beignWork完成成Fiber节点的创建，diff算法，调用render阶段的部分生命周期函数。")]),t._v(" "),n("p",[t._v("我们这一章将要完成对冒泡阶段全面分析。")]),t._v(" "),n("p",[t._v("let's go")]),t._v(" "),n("h2",{attrs:{id:"completeunitofwork"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#completeunitofwork"}},[t._v("#")]),t._v(" completeUnitOfWork")]),t._v(" "),n("ul",[n("li",[t._v("参数\n"),n("ol",[n("li",[t._v("unitOfWork：render阶段构建的fiber，如果当前节点有子节点，那么子节点已经完成complete")])])]),t._v(" "),n("li",[t._v("行为\n"),n("ol",[n("li",[t._v("调用completeWork")]),t._v(" "),n("li",[t._v("生成effectList")])])])]),t._v(" "),n("p",[t._v("我们先来看看completeWork来做什么了，后面我们会详细的来讲effectList。")]),t._v(" "),n("div",{staticClass:"language-javascript extra-class"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("completeUnitOfWork")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("unitOfWork"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Fiber")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// render完成的fiber")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" completedWork "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" unitOfWork"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("do")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  \t\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 当前渲染的节点，如果current为空，表示mount，不为空表示更新")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" current "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" completedWork"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("alternate"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" returnFiber "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" completedWork"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("return"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("completedWork"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("flags "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v(" Incomplete"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" NoFlags"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setCurrentDebugFiberInDEV")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("completedWork"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" next"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("enableProfilerTimer "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("completedWork"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mode "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v(" ProfileMode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" NoMode\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 创建出更新")]),t._v("\n          next "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("completeWork")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("current"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" completedWork"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" subtreeRenderLanes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// startProfilerTimer 和 stopProfilerTimerIfRunningAndRecordDelta 用来统计当前阶段渲染时间")]),t._v("\n        \t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// fiber.actualDuration 和 fiber.selfBaseDuration 变量赋值")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("startProfilerTimer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("completedWork"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n          next "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("completeWork")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("current"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" completedWork"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" subtreeRenderLanes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("stopProfilerTimerIfRunningAndRecordDelta")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("completedWork"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("resetCurrentDebugFiberInDEV")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("next "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          workInProgress "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" next"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("resetChildLanes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("completedWork"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t\t\t\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 构建effectList")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n          returnFiber "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("returnFiber"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("flags "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v(" Incomplete"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" NoFlags\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("returnFiber"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("firstEffect "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            returnFiber"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("firstEffect "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" completedWork"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("firstEffect"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("completedWork"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lastEffect "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("returnFiber"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lastEffect "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n              returnFiber"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lastEffect"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("nextEffect "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" completedWork"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("firstEffect"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            returnFiber"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lastEffect "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" completedWork"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lastEffect"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n          "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" flags "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" completedWork"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("flags"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("flags "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" PerformedWork"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("returnFiber"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lastEffect "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n              returnFiber"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lastEffect"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("nextEffect "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" completedWork"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n              returnFiber"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("firstEffect "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" completedWork"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            returnFiber"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lastEffect "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" completedWork"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" next "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("unwindWork")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("completedWork"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" subtreeRenderLanes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("next "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          next"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("flags "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&=")]),t._v(" HostEffectMask"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n          workInProgress "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" next"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n          enableProfilerTimer "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("completedWork"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mode "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v(" ProfileMode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" NoMode\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("stopProfilerTimerIfRunningAndRecordDelta")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("completedWork"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" actualDuration "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" completedWork"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("actualDuration"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" child "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" completedWork"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("child"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("child "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            actualDuration "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),t._v(" child"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("actualDuration"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            child "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" child"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sibling"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n          "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n          completedWork"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("actualDuration "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" actualDuration"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("returnFiber "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          returnFiber"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("firstEffect "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" returnFiber"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lastEffect "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n          returnFiber"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("flags "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|=")]),t._v(" Incomplete"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" siblingFiber "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" completedWork"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sibling"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("siblingFiber "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        workInProgress "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" siblingFiber"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      completedWork "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" returnFiber"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      workInProgress "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" completedWork"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("completedWork "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("workInProgressRootExitStatus "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" RootIncomplete"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      workInProgressRootExitStatus "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" RootCompleted"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h2",{attrs:{id:"completework"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#completework"}},[t._v("#")]),t._v(" completeWork")]),t._v(" "),n("ul",[n("li",[t._v("参数\n"),n("ol",[n("li",[t._v("current：当前渲染的fiber")]),t._v(" "),n("li",[t._v("workInProgress：workInProgress中的fiber")]),t._v(" "),n("li",[t._v("renderLanes：lane优先级")])])])]),t._v(" "),n("p",[t._v("根据代码我们可以看出，"),n("code",[t._v("completeWork")]),t._v("函数，主要是根据tag，处理不同类型的Component，很多类型Component是直接返回的，主要处理的是可以生成DOM的component。")]),t._v(" "),n("p",[t._v("我们以HostComponent（原生DOM节点）为例进行讲解，有代码可以看出，整个过程可以分为两部分：")]),t._v(" "),n("ul",[n("li",[t._v("current !== null 表示update")]),t._v(" "),n("li",[t._v("current === null 表示mount")])]),t._v(" "),n("div",{staticClass:"language-javascript extra-class"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("completeWork")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("current"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Fiber "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  workInProgress"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Fiber"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  renderLanes"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Lanes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Fiber "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" newProps "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" workInProgress"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pendingProps"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("switch")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("workInProgress"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("tag"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" IndeterminateComponent"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" LazyComponent"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" SimpleMemoComponent"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" FunctionComponent"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" ForwardRef"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" Fragment"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" Mode"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" Profiler"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" ContextConsumer"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" MemoComponent"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" ClassComponent"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" Component "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" workInProgress"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("type"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("isLegacyContextProvider")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Component"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("popLegacyContext")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("workInProgress"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...省略")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// HostComponent")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" HostComponent"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("popHostContext")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("workInProgress"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" rootContainerInstance "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getRootHostContainer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" type "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" workInProgress"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("type"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("current "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" workInProgress"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("stateNode "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// update 节点")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n       "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// mount 节点")]),t._v("\n     "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n     "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...省略case")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h3",{attrs:{id:"update"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#update"}},[t._v("#")]),t._v(" update")]),t._v(" "),n("p",[t._v("update时表示当前节点已经有DOM渲染了，也就是说存在原生DOM了，此时我们不需要进行DOM的创建了，只需要更新DOM的属性就好。"),n("code",[t._v("updateHostComponent")]),t._v("进行更新。")]),t._v(" "),n("div",{staticClass:"language-javascript extra-class"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("current "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" workInProgress"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("stateNode "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  \t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 更新DOM属性")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("updateHostComponent")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n      current"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      workInProgress"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      type"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      newProps"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      rootContainerInstance"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("current"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ref "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" workInProgress"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ref"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("markRef")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("workInProgress"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h4",{attrs:{id:"updatehostcomponent"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#updatehostcomponent"}},[t._v("#")]),t._v(" updateHostComponent")]),t._v(" "),n("ul",[n("li",[t._v("参数\n"),n("ol",[n("li",[t._v("current：当前渲染的fiber")]),t._v(" "),n("li",[t._v("workInProgress：workInProgress fiber")]),t._v(" "),n("li",[t._v("type：tagName")]),t._v(" "),n("li",[t._v("newProps：newProps")]),t._v(" "),n("li",[t._v("rootContainerInstance")])])])]),t._v(" "),n("p",[n("code",[t._v("updateHostComponent")]),t._v("最主要的功能就是处理props，并将处理的结果赋值给"),n("code",[t._v("workInProgress.updateQueue")]),t._v("。"),n("code",[t._v("prepareUpdate")]),t._v(" 函数只是调用了"),n("code",[t._v("diffProperties")]),t._v("函数，接下来我们看看``函数。")]),t._v(" "),n("div",{staticClass:"language-tsx extra-class"},[n("pre",{pre:!0,attrs:{class:"language-tsx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("updateHostComponent")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("current"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Fiber"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    workInProgress"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Fiber"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    type"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Type"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    newProps"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Props"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    rootContainerInstance"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Container"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")])]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  \t\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 渲染的props")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" oldProps "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" current"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("memoizedProps"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  \t\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 浅比较")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("oldProps "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" newProps"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" instance"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Instance "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" workInProgress"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("stateNode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" currentHostContext "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getHostContext")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" updatePayload "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("prepareUpdate")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n        instance"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        oldProps"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        newProps"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        rootContainerInstance"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        currentHostContext"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      workInProgress"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("updateQueue "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("updatePayload"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("any")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("updatePayload"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("markUpdate")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("workInProgress"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("h4",{attrs:{id:"diffproperties"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#diffproperties"}},[t._v("#")]),t._v(" diffProperties")]),t._v(" "),n("ul",[n("li",[t._v("参数\n"),n("ol",[n("li",[t._v("domElement：dom实例")]),t._v(" "),n("li",[t._v("tag：tagName")]),t._v(" "),n("li",[t._v("lastRawProps：渲染的props")]),t._v(" "),n("li",[t._v("nextRawProps：当前的props")])])])]),t._v(" "),n("p",[t._v("在"),n("code",[t._v("diffProperties")]),t._v("函数中主要有两个for循环组成，第一个for是为了处理已删除的props，也就是当前dom渲染出来的属性，但下次渲染此属性下次渲染将要删除，这样的情况会在updatePayload中push propKey和null。第二个for循环是处理修改或添加属性。")]),t._v(" "),n("blockquote",[n("p",[t._v("updatePayload的类型位Array，奇数位为propKey，偶数位为propValue")])]),t._v(" "),n("div",{staticClass:"language-tsx extra-class"},[n("pre",{pre:!0,attrs:{class:"language-tsx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("diffProperties")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("domElement"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Element"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  tag"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" string"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  lastRawProps"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Object"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  nextRawProps"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Object"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  rootContainerElement"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Element "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" Document"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("Array")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("mixed"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...省略")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" updatePayload"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("Array")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("any")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" lastProps"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Object"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" nextProps"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Object"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("switch")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("tag"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...省略case")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("assertValidProps")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("tag"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" nextProps"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" propKey"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" styleName"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" styleUpdates "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 处理渲染有的属性，且当前props没有的情况，将updatePayload添加[key,null]")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("propKey "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" lastProps"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n      nextProps"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("hasOwnProperty")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("propKey"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("lastProps"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("hasOwnProperty")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("propKey"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v("\n      lastProps"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("propKey"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("continue")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...省略if分支")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// For all other deleted properties we add it to the queue. We use")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// the allowed property list in the commit phase instead.")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("updatePayload "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" updatePayload "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("push")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("propKey"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 更新属性")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("propKey "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" nextProps"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" nextProp "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" nextProps"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("propKey"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" lastProp "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" lastProps "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" lastProps"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("propKey"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("undefined")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("nextProps"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("hasOwnProperty")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("propKey"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v("\n      nextProp "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" lastProp "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("nextProp "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" lastProp "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("continue")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 省略if分支...")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("updatePayload "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" updatePayload "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("push")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("propKey"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" nextProp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("styleUpdates"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__DEV__"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("validateShorthandPropertyCollisionInDev")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("styleUpdates"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" nextProps"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("STYLE")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("updatePayload "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" updatePayload "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("push")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("STYLE")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" styleUpdates"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" updatePayload"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h4",{attrs:{id:"总结"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[t._v("#")]),t._v(" 总结")]),t._v(" "),n("p",[t._v("在update阶段，"),n("code",[t._v("workInProgress.updateQueue")]),t._v("生成数据，数据会在commit阶段进行更新处理。")]),t._v(" "),n("h3",{attrs:{id:"mount"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#mount"}},[t._v("#")]),t._v(" mount")]),t._v(" "),n("p",[t._v("mount主要完成以下几件事")]),t._v(" "),n("ol",[n("li",[t._v("创建DOM实例")]),t._v(" "),n("li",[t._v("将当前节点的children节点，插入到当前节点中，性能优化。可以将本次节点以及子节点可以一次性插入到页面页面中")]),t._v(" "),n("li",[t._v("在"),n("code",[t._v("finalizeInitialChildren")]),t._v("函数中会初始化属性和挂载相应的事件")])]),t._v(" "),n("div",{staticClass:"language-tsx extra-class"},[n("pre",{pre:!0,attrs:{class:"language-tsx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 创建DOM实例")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" instance "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("createInstance")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    newProps"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    rootContainerInstance"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    currentHostContext"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    workInProgress"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 将子节点添加到当前节点")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("appendAllChildren")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("instance"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" workInProgress"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nworkInProgress"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("stateNode "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" instance"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 设置属性")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("finalizeInitialChildren")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    instance"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    newProps"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    rootContainerInstance"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    currentHostContext"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  \t"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("markUpdate")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("workInProgress"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])]),n("h2",{attrs:{id:"effect-list"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#effect-list"}},[t._v("#")]),t._v(" effect list")]),t._v(" "),n("p",[t._v("现在render阶段就剩下一件事了，那就是生成effect list。那么为什么要生成effec list呢，总结一句话就是为了效率。因为在commit阶段我们要找到所有fiber带有effect tag的节点，如果我们不生成effect list，那么我们就要对整个fiber进行遍历了，这当然是不可以接受的。所以我们render阶段形成一条更新链表。")]),t._v(" "),n("p",[t._v("effect list 相关的属性主要是：")]),t._v(" "),n("div",{staticClass:"language-tsx extra-class"},[n("pre",{pre:!0,attrs:{class:"language-tsx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 下个节点")]),t._v("\nnextEffect"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Fiber "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 要更新的第一个节点")]),t._v("\nfirstEffect"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Fiber "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 更新的最后一个节点")]),t._v("\nlastEffect"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Fiber "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n")])])]),n("p",[t._v("那么effect list怎么形成的呢？")]),t._v(" "),n("ul",[n("li",[t._v("处理子节点\n"),n("ol",[n("li",[t._v("处理父节点的"),n("code",[t._v("firstEffect")]),t._v("，如果"),n("code",[t._v("returnFiber.firstEffect === null")]),t._v("则将当前节点的"),n("code",[t._v("firstEffect")]),t._v("赋值给父节点。注意这是在commit阶段处理的第一个节点")]),t._v(" "),n("li",[t._v("处理父节点"),n("code",[t._v("lastEffect")])])])]),t._v(" "),n("li",[t._v("处理当前节点\n"),n("ol",[n("li",[t._v("讲当前节点加入到effect list中")])])])]),t._v(" "),n("div",{staticClass:"language-tsx extra-class"},[n("pre",{pre:!0,attrs:{class:"language-tsx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("returnFiber "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("returnFiber"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("flags "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v(" Incomplete"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" NoFlags"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 处理child节点")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("returnFiber"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("firstEffect "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      returnFiber"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("firstEffect "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" completedWork"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("firstEffect"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("completedWork"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lastEffect "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("returnFiber"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lastEffect "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        returnFiber"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lastEffect"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("nextEffect "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" completedWork"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("firstEffect"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      returnFiber"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lastEffect "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" completedWork"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lastEffect"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" flags "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" completedWork"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("flags"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  \t"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 讲当前节点加入加入到effect中")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("flags "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" PerformedWork"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("returnFiber"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lastEffect "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        returnFiber"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lastEffect"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("nextEffect "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" completedWork"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        returnFiber"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("firstEffect "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" completedWork"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      returnFiber"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("lastEffect "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" completedWork"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("讲到这里你可能还是不理解这个链表怎么形成的，举个栗子来说明，如下图：")]),t._v(" "),n("br"),t._v(" "),n("img",{attrs:{src:a(369)}}),t._v(" "),n("br"),t._v(" "),n("p",[t._v("整个流程如下：")]),t._v(" "),n("ul",[n("li",[t._v("p节点complete，此时"),n("code",[t._v("returnFiber")]),t._v("为test节点\n"),n("ol",[n("li",[n("code",[t._v("returnFiber")]),t._v("的"),n("code",[t._v("firstEffect")]),t._v("为null，"),n("code",[t._v("returnFiber.firstEffect = completedWork.firstEffect")]),t._v("，completedWork.firstEffect === null，所以赋值完成后"),n("code",[t._v("returnFiber.firstEffect")]),t._v(" === null")]),t._v(" "),n("li",[n("code",[t._v("returnFiber.firstEffect = completedWork")])]),t._v(" "),n("li",[n("code",[t._v("returnFiber.lastEffect = completedWork")])])])])]),t._v(" "),n("br"),t._v(" "),n("p",[t._v("​\t"),n("img",{attrs:{src:a(370)}})]),t._v(" "),n("br"),t._v(" "),n("ul",[n("li",[t._v("button 节点 complete，此时"),n("code",[t._v("returnFiber")]),t._v("为test节点\n"),n("ol",[n("li",[n("code",[t._v("returnFiber.lastEffect.nextEffect = completedWork")]),t._v("，也就是说，p.nextEffect = button")]),t._v(" "),n("li",[n("code",[t._v("returnFiber.lastEffect = completedWork")]),t._v("，texst.lastEffect = button")])])])]),t._v(" "),n("br"),t._v(" "),n("p",[t._v("​\t"),n("img",{attrs:{src:a(371)}})]),t._v(" "),n("br"),t._v(" "),n("ul",[n("li",[t._v("test 节点 complete，此时"),n("code",[t._v("returnFiber")]),t._v("为div节点\n"),n("ol",[n("li",[n("code",[t._v("returnFiber.firstEffect = completedWork.firstEffect")]),t._v("，即：div.firstEffect= p")]),t._v(" "),n("li",[n("code",[t._v("returnFiber.lastEffect = completedWork.lastEffect")]),t._v(",  即：div.lastEffect = button")]),t._v(" "),n("li",[n("code",[t._v("returnFiber.lastEffect.nextEffect = completedWork")]),t._v("，即：button.next = test")]),t._v(" "),n("li",[t._v("returnFiber.lastEffect = completedWork，即：div.lastEffect = test")])])])]),t._v(" "),n("br"),t._v(" "),n("p",[t._v("​\t"),n("img",{attrs:{src:a(372)}})]),t._v(" "),n("br"),t._v(" "),n("ul",[n("li",[t._v("div 节点 complete，此时"),n("code",[t._v("returnFiber")]),t._v("为app节点\n"),n("ol",[n("li",[n("code",[t._v("returnFiber.firstEffect = completedWork.firstEffect")]),t._v("，即：app.firstEffect= p")]),t._v(" "),n("li",[n("code",[t._v("returnFiber.lastEffect = completedWork.lastEffect")]),t._v("，即：app.lastEffect = test")]),t._v(" "),n("li",[n("code",[t._v("returnFiber.lastEffect.nextEffect = completedWork")]),t._v("，即：test.next = div")]),t._v(" "),n("li",[n("code",[t._v("returnFiber.lastEffect = completedWork")]),t._v("，即：app.lastEffect= div")])])])]),t._v(" "),n("br"),t._v(" "),n("p",[t._v("​\t"),n("img",{attrs:{src:a(373)}})]),t._v(" "),n("br"),t._v(" "),n("h2",{attrs:{id:"总结-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#总结-2"}},[t._v("#")]),t._v(" 总结")]),t._v(" "),n("p",[t._v("至此我们在commit阶段的工作全部完成，有上述effectList可以看出，firstEffect节点为P节点，也就是说，在commit阶段的更新是从下向上的更新（简而言之，子组件的"),n("code",[t._v("componentDidUpdate")]),t._v("生命周期比父组件早调用）。")]),t._v(" "),n("p",[t._v("下一章我们进行遗留问题，diff算法的学习")])])}),[],!1,null,null,null);s.default=e.exports}}]);