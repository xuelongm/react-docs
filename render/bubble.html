<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>冒泡阶段 | React Docs</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="docs React 17x">
    
    <link rel="preload" href="/react-docs/assets/css/0.styles.81a1deae.css" as="style"><link rel="preload" href="/react-docs/assets/js/app.8dcc01f4.js" as="script"><link rel="preload" href="/react-docs/assets/js/2.ba3186f0.js" as="script"><link rel="preload" href="/react-docs/assets/js/3.3c0ce97a.js" as="script"><link rel="prefetch" href="/react-docs/assets/js/10.97b71cf3.js"><link rel="prefetch" href="/react-docs/assets/js/11.8e76ad41.js"><link rel="prefetch" href="/react-docs/assets/js/12.d7ad81f6.js"><link rel="prefetch" href="/react-docs/assets/js/13.355108e6.js"><link rel="prefetch" href="/react-docs/assets/js/14.17c70a90.js"><link rel="prefetch" href="/react-docs/assets/js/15.8f367758.js"><link rel="prefetch" href="/react-docs/assets/js/4.53506a7c.js"><link rel="prefetch" href="/react-docs/assets/js/5.4519f0f6.js"><link rel="prefetch" href="/react-docs/assets/js/6.8eb97706.js"><link rel="prefetch" href="/react-docs/assets/js/7.a6b7cea6.js"><link rel="prefetch" href="/react-docs/assets/js/8.df1bb6b2.js"><link rel="prefetch" href="/react-docs/assets/js/9.c78a0cc5.js">
    <link rel="stylesheet" href="/react-docs/assets/css/0.styles.81a1deae.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/react-docs/" class="home-link router-link-active"><!----> <span class="site-name">React Docs</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/react-docs/" class="nav-link">
  Home
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/react-docs/" class="nav-link">
  Home
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/react-docs/" aria-current="page" class="sidebar-link">首页</a></li><li><a href="/react-docs/concept.html" class="sidebar-link">概念篇</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>render</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/react-docs/render/overview.html" class="sidebar-link">概览</a></li><li><a href="/react-docs/render/capture.html" class="sidebar-link">捕获阶段</a></li><li><a href="/react-docs/render/bubble.html" aria-current="page" class="active sidebar-link">冒泡阶段</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/react-docs/render/bubble.html#completeunitofwork" class="sidebar-link">completeUnitOfWork</a></li><li class="sidebar-sub-header"><a href="/react-docs/render/bubble.html#completework" class="sidebar-link">completeWork</a></li><li class="sidebar-sub-header"><a href="/react-docs/render/bubble.html#effect-list" class="sidebar-link">effect list</a></li><li class="sidebar-sub-header"><a href="/react-docs/render/bubble.html#总结-2" class="sidebar-link">总结</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>commit</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>diff</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>状态更新</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="冒泡阶段"><a href="#冒泡阶段" class="header-anchor">#</a> 冒泡阶段</h1> <p>冒泡阶段的起始函数是<code>completeUnitOfWork</code>。</p> <p>在上一章我们知道了beignWork完成成Fiber节点的创建，diff算法，调用render阶段的部分生命周期函数。</p> <p>我们这一章将要完成对冒泡阶段全面分析。</p> <p>let's go</p> <h2 id="completeunitofwork"><a href="#completeunitofwork" class="header-anchor">#</a> completeUnitOfWork</h2> <ul><li>参数
<ol><li>unitOfWork：render阶段构建的fiber，如果当前节点有子节点，那么子节点已经完成complete</li></ol></li> <li>行为
<ol><li>调用completeWork</li> <li>生成effectList</li></ol></li></ul> <p>我们先来看看completeWork来做什么了，后面我们会详细的来讲effectList。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">completeUnitOfWork</span><span class="token punctuation">(</span><span class="token parameter">unitOfWork<span class="token operator">:</span> Fiber</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token comment">// render完成的fiber</span>
    <span class="token keyword">let</span> completedWork <span class="token operator">=</span> unitOfWork<span class="token punctuation">;</span>
    <span class="token keyword">do</span> <span class="token punctuation">{</span>
  		<span class="token comment">// 当前渲染的节点，如果current为空，表示mount，不为空表示更新</span>
      <span class="token keyword">const</span> current <span class="token operator">=</span> completedWork<span class="token punctuation">.</span>alternate<span class="token punctuation">;</span>
      <span class="token keyword">const</span> returnFiber <span class="token operator">=</span> completedWork<span class="token punctuation">.</span>return<span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>completedWork<span class="token punctuation">.</span>flags <span class="token operator">&amp;</span> Incomplete<span class="token punctuation">)</span> <span class="token operator">===</span> NoFlags<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">setCurrentDebugFiberInDEV</span><span class="token punctuation">(</span>completedWork<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> next<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>
          <span class="token operator">!</span>enableProfilerTimer <span class="token operator">||</span>
          <span class="token punctuation">(</span>completedWork<span class="token punctuation">.</span>mode <span class="token operator">&amp;</span> ProfileMode<span class="token punctuation">)</span> <span class="token operator">===</span> NoMode
        <span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// 创建出更新</span>
          next <span class="token operator">=</span> <span class="token function">completeWork</span><span class="token punctuation">(</span>current<span class="token punctuation">,</span> completedWork<span class="token punctuation">,</span> subtreeRenderLanes<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token comment">// startProfilerTimer 和 stopProfilerTimerIfRunningAndRecordDelta 用来统计当前阶段渲染时间</span>
        	<span class="token comment">// fiber.actualDuration 和 fiber.selfBaseDuration 变量赋值</span>
          <span class="token function">startProfilerTimer</span><span class="token punctuation">(</span>completedWork<span class="token punctuation">)</span><span class="token punctuation">;</span>
          next <span class="token operator">=</span> <span class="token function">completeWork</span><span class="token punctuation">(</span>current<span class="token punctuation">,</span> completedWork<span class="token punctuation">,</span> subtreeRenderLanes<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token function">stopProfilerTimerIfRunningAndRecordDelta</span><span class="token punctuation">(</span>completedWork<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">resetCurrentDebugFiberInDEV</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>next <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          workInProgress <span class="token operator">=</span> next<span class="token punctuation">;</span>
          <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token function">resetChildLanes</span><span class="token punctuation">(</span>completedWork<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token comment">// 构建effectList</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>
          returnFiber <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span>
          <span class="token punctuation">(</span>returnFiber<span class="token punctuation">.</span>flags <span class="token operator">&amp;</span> Incomplete<span class="token punctuation">)</span> <span class="token operator">===</span> NoFlags
        <span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>returnFiber<span class="token punctuation">.</span>firstEffect <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            returnFiber<span class="token punctuation">.</span>firstEffect <span class="token operator">=</span> completedWork<span class="token punctuation">.</span>firstEffect<span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>completedWork<span class="token punctuation">.</span>lastEffect <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>returnFiber<span class="token punctuation">.</span>lastEffect <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              returnFiber<span class="token punctuation">.</span>lastEffect<span class="token punctuation">.</span>nextEffect <span class="token operator">=</span> completedWork<span class="token punctuation">.</span>firstEffect<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            returnFiber<span class="token punctuation">.</span>lastEffect <span class="token operator">=</span> completedWork<span class="token punctuation">.</span>lastEffect<span class="token punctuation">;</span>
          <span class="token punctuation">}</span>

          <span class="token keyword">const</span> flags <span class="token operator">=</span> completedWork<span class="token punctuation">.</span>flags<span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>flags <span class="token operator">&gt;</span> PerformedWork<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>returnFiber<span class="token punctuation">.</span>lastEffect <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              returnFiber<span class="token punctuation">.</span>lastEffect<span class="token punctuation">.</span>nextEffect <span class="token operator">=</span> completedWork<span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
              returnFiber<span class="token punctuation">.</span>firstEffect <span class="token operator">=</span> completedWork<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            returnFiber<span class="token punctuation">.</span>lastEffect <span class="token operator">=</span> completedWork<span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> next <span class="token operator">=</span> <span class="token function">unwindWork</span><span class="token punctuation">(</span>completedWork<span class="token punctuation">,</span> subtreeRenderLanes<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>next <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          next<span class="token punctuation">.</span>flags <span class="token operator">&amp;=</span> HostEffectMask<span class="token punctuation">;</span>
          workInProgress <span class="token operator">=</span> next<span class="token punctuation">;</span>
          <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>
          enableProfilerTimer <span class="token operator">&amp;&amp;</span>
          <span class="token punctuation">(</span>completedWork<span class="token punctuation">.</span>mode <span class="token operator">&amp;</span> ProfileMode<span class="token punctuation">)</span> <span class="token operator">!==</span> NoMode
        <span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">stopProfilerTimerIfRunningAndRecordDelta</span><span class="token punctuation">(</span>completedWork<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">let</span> actualDuration <span class="token operator">=</span> completedWork<span class="token punctuation">.</span>actualDuration<span class="token punctuation">;</span>
          <span class="token keyword">let</span> child <span class="token operator">=</span> completedWork<span class="token punctuation">.</span>child<span class="token punctuation">;</span>
          <span class="token keyword">while</span> <span class="token punctuation">(</span>child <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            actualDuration <span class="token operator">+=</span> child<span class="token punctuation">.</span>actualDuration<span class="token punctuation">;</span>
            child <span class="token operator">=</span> child<span class="token punctuation">.</span>sibling<span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          completedWork<span class="token punctuation">.</span>actualDuration <span class="token operator">=</span> actualDuration<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>returnFiber <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          returnFiber<span class="token punctuation">.</span>firstEffect <span class="token operator">=</span> returnFiber<span class="token punctuation">.</span>lastEffect <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
          returnFiber<span class="token punctuation">.</span>flags <span class="token operator">|=</span> Incomplete<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">const</span> siblingFiber <span class="token operator">=</span> completedWork<span class="token punctuation">.</span>sibling<span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>siblingFiber <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        workInProgress <span class="token operator">=</span> siblingFiber<span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      completedWork <span class="token operator">=</span> returnFiber<span class="token punctuation">;</span>
      workInProgress <span class="token operator">=</span> completedWork<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>completedWork <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>workInProgressRootExitStatus <span class="token operator">===</span> RootIncomplete<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      workInProgressRootExitStatus <span class="token operator">=</span> RootCompleted<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="completework"><a href="#completework" class="header-anchor">#</a> completeWork</h2> <ul><li>参数
<ol><li>current：当前渲染的fiber</li> <li>workInProgress：workInProgress中的fiber</li> <li>renderLanes：lane优先级</li></ol></li></ul> <p>根据代码我们可以看出，<code>completeWork</code>函数，主要是根据tag，处理不同类型的Component，很多类型Component是直接返回的，主要处理的是可以生成DOM的component。</p> <p>我们以HostComponent（原生DOM节点）为例进行讲解，有代码可以看出，整个过程可以分为两部分：</p> <ul><li>current !== null 表示update</li> <li>current === null 表示mount</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">completeWork</span><span class="token punctuation">(</span>
  <span class="token parameter">current<span class="token operator">:</span> Fiber <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  workInProgress<span class="token operator">:</span> Fiber<span class="token punctuation">,</span>
  renderLanes<span class="token operator">:</span> Lanes<span class="token punctuation">,</span></span>
<span class="token punctuation">)</span><span class="token operator">:</span> Fiber <span class="token operator">|</span> <span class="token keyword">null</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> newProps <span class="token operator">=</span> workInProgress<span class="token punctuation">.</span>pendingProps<span class="token punctuation">;</span>

  <span class="token keyword">switch</span> <span class="token punctuation">(</span>workInProgress<span class="token punctuation">.</span>tag<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> IndeterminateComponent<span class="token operator">:</span>
    <span class="token keyword">case</span> LazyComponent<span class="token operator">:</span>
    <span class="token keyword">case</span> SimpleMemoComponent<span class="token operator">:</span>
    <span class="token keyword">case</span> FunctionComponent<span class="token operator">:</span>
    <span class="token keyword">case</span> ForwardRef<span class="token operator">:</span>
    <span class="token keyword">case</span> Fragment<span class="token operator">:</span>
    <span class="token keyword">case</span> Mode<span class="token operator">:</span>
    <span class="token keyword">case</span> Profiler<span class="token operator">:</span>
    <span class="token keyword">case</span> ContextConsumer<span class="token operator">:</span>
    <span class="token keyword">case</span> MemoComponent<span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> ClassComponent<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> Component <span class="token operator">=</span> workInProgress<span class="token punctuation">.</span>type<span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isLegacyContextProvider</span><span class="token punctuation">(</span>Component<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">popLegacyContext</span><span class="token punctuation">(</span>workInProgress<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// ...省略</span>
    <span class="token comment">// HostComponent</span>
    <span class="token keyword">case</span> HostComponent<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token function">popHostContext</span><span class="token punctuation">(</span>workInProgress<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> rootContainerInstance <span class="token operator">=</span> <span class="token function">getRootHostContainer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> type <span class="token operator">=</span> workInProgress<span class="token punctuation">.</span>type<span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>current <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> workInProgress<span class="token punctuation">.</span>stateNode <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// update 节点</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
       <span class="token comment">// mount 节点</span>
     <span class="token punctuation">}</span>
     <span class="token comment">// ...省略case</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="update"><a href="#update" class="header-anchor">#</a> update</h3> <p>update时表示当前节点已经有DOM渲染了，也就是说存在原生DOM了，此时我们不需要进行DOM的创建了，只需要更新DOM的属性就好。<code>updateHostComponent</code>进行更新。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>current <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> workInProgress<span class="token punctuation">.</span>stateNode <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  	<span class="token comment">// 更新DOM属性</span>
    <span class="token function">updateHostComponent</span><span class="token punctuation">(</span>
      current<span class="token punctuation">,</span>
      workInProgress<span class="token punctuation">,</span>
      type<span class="token punctuation">,</span>
      newProps<span class="token punctuation">,</span>
      rootContainerInstance<span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>current<span class="token punctuation">.</span>ref <span class="token operator">!==</span> workInProgress<span class="token punctuation">.</span>ref<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">markRef</span><span class="token punctuation">(</span>workInProgress<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="updatehostcomponent"><a href="#updatehostcomponent" class="header-anchor">#</a> updateHostComponent</h4> <ul><li>参数
<ol><li>current：当前渲染的fiber</li> <li>workInProgress：workInProgress fiber</li> <li>type：tagName</li> <li>newProps：newProps</li> <li>rootContainerInstance</li></ol></li></ul> <p><code>updateHostComponent</code>最主要的功能就是处理props，并将处理的结果赋值给<code>workInProgress.updateQueue</code>。<code>prepareUpdate</code> 函数只是调用了<code>diffProperties</code>函数，接下来我们看看``函数。</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token function-variable function">updateHostComponent</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>
    <span class="token parameter">current<span class="token operator">:</span> Fiber<span class="token punctuation">,</span>
    workInProgress<span class="token operator">:</span> Fiber<span class="token punctuation">,</span>
    type<span class="token operator">:</span> Type<span class="token punctuation">,</span>
    newProps<span class="token operator">:</span> Props<span class="token punctuation">,</span>
    rootContainerInstance<span class="token operator">:</span> Container<span class="token punctuation">,</span></span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
  		<span class="token comment">// 渲染的props</span>
      <span class="token keyword">const</span> oldProps <span class="token operator">=</span> current<span class="token punctuation">.</span>memoizedProps<span class="token punctuation">;</span>
  		<span class="token comment">// 浅比较</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>oldProps <span class="token operator">===</span> newProps<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">const</span> instance<span class="token operator">:</span> Instance <span class="token operator">=</span> workInProgress<span class="token punctuation">.</span>stateNode<span class="token punctuation">;</span>
      <span class="token keyword">const</span> currentHostContext <span class="token operator">=</span> <span class="token function">getHostContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> updatePayload <span class="token operator">=</span> <span class="token function">prepareUpdate</span><span class="token punctuation">(</span>
        instance<span class="token punctuation">,</span>
        <span class="token keyword">type</span><span class="token punctuation">,</span>
        oldProps<span class="token punctuation">,</span>
        newProps<span class="token punctuation">,</span>
        rootContainerInstance<span class="token punctuation">,</span>
        currentHostContext<span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
      workInProgress<span class="token punctuation">.</span>updateQueue <span class="token operator">=</span> <span class="token punctuation">(</span>updatePayload<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>updatePayload<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">markUpdate</span><span class="token punctuation">(</span>workInProgress<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="diffproperties"><a href="#diffproperties" class="header-anchor">#</a> diffProperties</h4> <ul><li>参数
<ol><li>domElement：dom实例</li> <li>tag：tagName</li> <li>lastRawProps：渲染的props</li> <li>nextRawProps：当前的props</li></ol></li></ul> <p>在<code>diffProperties</code>函数中主要有两个for循环组成，第一个for是为了处理已删除的props，也就是当前dom渲染出来的属性，但下次渲染此属性下次渲染将要删除，这样的情况会在updatePayload中push propKey和null。第二个for循环是处理修改或添加属性。</p> <blockquote><p>updatePayload的类型位Array，奇数位为propKey，偶数位为propValue</p></blockquote> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">diffProperties</span><span class="token punctuation">(</span>
  <span class="token parameter">domElement<span class="token operator">:</span> Element<span class="token punctuation">,</span>
  tag<span class="token operator">:</span> string<span class="token punctuation">,</span>
  lastRawProps<span class="token operator">:</span> Object<span class="token punctuation">,</span>
  nextRawProps<span class="token operator">:</span> Object<span class="token punctuation">,</span>
  rootContainerElement<span class="token operator">:</span> Element <span class="token operator">|</span> Document<span class="token punctuation">,</span></span>
<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">null</span> <span class="token operator">|</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span>mixed<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...省略</span>
  <span class="token keyword">let</span> updatePayload<span class="token operator">:</span> <span class="token keyword">null</span> <span class="token operator">|</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> lastProps<span class="token operator">:</span> Object<span class="token punctuation">;</span>
  <span class="token keyword">let</span> nextProps<span class="token operator">:</span> Object<span class="token punctuation">;</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>tag<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...省略case</span>
  <span class="token punctuation">}</span>

  <span class="token function">assertValidProps</span><span class="token punctuation">(</span>tag<span class="token punctuation">,</span> nextProps<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">let</span> propKey<span class="token punctuation">;</span>
  <span class="token keyword">let</span> styleName<span class="token punctuation">;</span>
  <span class="token keyword">let</span> styleUpdates <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token comment">// 处理渲染有的属性，且当前props没有的情况，将updatePayload添加[key,null]</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span>propKey <span class="token keyword">in</span> lastProps<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>
      nextProps<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span>propKey<span class="token punctuation">)</span> <span class="token operator">||</span>
      <span class="token operator">!</span>lastProps<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span>propKey<span class="token punctuation">)</span> <span class="token operator">||</span>
      lastProps<span class="token punctuation">[</span>propKey<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token keyword">null</span>
    <span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">continue</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// ...省略if分支</span>
    <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// For all other deleted properties we add it to the queue. We use</span>
      <span class="token comment">// the allowed property list in the commit phase instead.</span>
      <span class="token punctuation">(</span>updatePayload <span class="token operator">=</span> updatePayload <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>propKey<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 更新属性</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span>propKey <span class="token keyword">in</span> nextProps<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> nextProp <span class="token operator">=</span> nextProps<span class="token punctuation">[</span>propKey<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> lastProp <span class="token operator">=</span> lastProps <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span> lastProps<span class="token punctuation">[</span>propKey<span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>
      <span class="token operator">!</span>nextProps<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span>propKey<span class="token punctuation">)</span> <span class="token operator">||</span>
      nextProp <span class="token operator">===</span> lastProp <span class="token operator">||</span>
      <span class="token punctuation">(</span>nextProp <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> lastProp <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">continue</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 省略if分支...</span>
    <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token punctuation">(</span>updatePayload <span class="token operator">=</span> updatePayload <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>propKey<span class="token punctuation">,</span> nextProp<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>styleUpdates<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>__DEV__<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">validateShorthandPropertyCollisionInDev</span><span class="token punctuation">(</span>styleUpdates<span class="token punctuation">,</span> nextProps<span class="token punctuation">[</span><span class="token constant">STYLE</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">(</span>updatePayload <span class="token operator">=</span> updatePayload <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token constant">STYLE</span><span class="token punctuation">,</span> styleUpdates<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> updatePayload<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h4> <p>在update阶段，<code>workInProgress.updateQueue</code>生成数据，数据会在commit阶段进行更新处理。</p> <h3 id="mount"><a href="#mount" class="header-anchor">#</a> mount</h3> <p>mount主要完成以下几件事</p> <ol><li>创建DOM实例</li> <li>将当前节点的children节点，插入到当前节点中，性能优化。可以将本次节点以及子节点可以一次性插入到页面页面中</li> <li>在<code>finalizeInitialChildren</code>函数中会初始化属性和挂载相应的事件</li></ol> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token comment">// 创建DOM实例</span>
<span class="token keyword">const</span> instance <span class="token operator">=</span> <span class="token function">createInstance</span><span class="token punctuation">(</span>
    <span class="token keyword">type</span><span class="token punctuation">,</span>
    newProps<span class="token punctuation">,</span>
    rootContainerInstance<span class="token punctuation">,</span>
    currentHostContext<span class="token punctuation">,</span>
    workInProgress<span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 将子节点添加到当前节点</span>
<span class="token function">appendAllChildren</span><span class="token punctuation">(</span>instance<span class="token punctuation">,</span> workInProgress<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

workInProgress<span class="token punctuation">.</span>stateNode <span class="token operator">=</span> instance<span class="token punctuation">;</span>
<span class="token comment">// 设置属性</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>
  <span class="token function">finalizeInitialChildren</span><span class="token punctuation">(</span>
    instance<span class="token punctuation">,</span>
    <span class="token keyword">type</span><span class="token punctuation">,</span>
    newProps<span class="token punctuation">,</span>
    rootContainerInstance<span class="token punctuation">,</span>
    currentHostContext<span class="token punctuation">,</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  	<span class="token function">markUpdate</span><span class="token punctuation">(</span>workInProgress<span class="token punctuation">)</span><span class="token punctuation">;</span> 
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h2 id="effect-list"><a href="#effect-list" class="header-anchor">#</a> effect list</h2> <p>现在render阶段就剩下一件事了，那就是生成effect list。那么为什么要生成effec list呢，总结一句话就是为了效率。因为在commit阶段我们要找到所有fiber带有effect tag的节点，如果我们不生成effect list，那么我们就要对整个fiber进行遍历了，这当然是不可以接受的。所以我们render阶段形成一条更新链表。</p> <p>effect list 相关的属性主要是：</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token comment">// 下个节点</span>
nextEffect<span class="token operator">:</span> Fiber <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
<span class="token comment">// 要更新的第一个节点</span>
firstEffect<span class="token operator">:</span> Fiber <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
<span class="token comment">// 更新的最后一个节点</span>
lastEffect<span class="token operator">:</span> Fiber <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
</code></pre></div><p>那么effect list怎么形成的呢？</p> <ul><li>处理子节点
<ol><li>处理父节点的<code>firstEffect</code>，如果<code>returnFiber.firstEffect === null</code>则将当前节点的<code>firstEffect</code>赋值给父节点。注意这是在commit阶段处理的第一个节点</li> <li>处理父节点<code>lastEffect</code></li></ol></li> <li>处理当前节点
<ol><li>讲当前节点加入到effect list中</li></ol></li></ul> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>returnFiber <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>returnFiber<span class="token punctuation">.</span>flags <span class="token operator">&amp;</span> Incomplete<span class="token punctuation">)</span> <span class="token operator">===</span> NoFlags<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 处理child节点</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>returnFiber<span class="token punctuation">.</span>firstEffect <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      returnFiber<span class="token punctuation">.</span>firstEffect <span class="token operator">=</span> completedWork<span class="token punctuation">.</span>firstEffect<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>completedWork<span class="token punctuation">.</span>lastEffect <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>returnFiber<span class="token punctuation">.</span>lastEffect <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        returnFiber<span class="token punctuation">.</span>lastEffect<span class="token punctuation">.</span>nextEffect <span class="token operator">=</span> completedWork<span class="token punctuation">.</span>firstEffect<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      returnFiber<span class="token punctuation">.</span>lastEffect <span class="token operator">=</span> completedWork<span class="token punctuation">.</span>lastEffect<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> flags <span class="token operator">=</span> completedWork<span class="token punctuation">.</span>flags<span class="token punctuation">;</span>
  	<span class="token comment">// 讲当前节点加入加入到effect中</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>flags <span class="token operator">&gt;</span> PerformedWork<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>returnFiber<span class="token punctuation">.</span>lastEffect <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        returnFiber<span class="token punctuation">.</span>lastEffect<span class="token punctuation">.</span>nextEffect <span class="token operator">=</span> completedWork<span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        returnFiber<span class="token punctuation">.</span>firstEffect <span class="token operator">=</span> completedWork<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      returnFiber<span class="token punctuation">.</span>lastEffect <span class="token operator">=</span> completedWork<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>讲到这里你可能还是不理解这个链表怎么形成的，举个栗子来说明，如下图：</p> <br> <img src="data:image/png;base64,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"> <br> <p>整个流程如下：</p> <ul><li>p节点complete，此时<code>returnFiber</code>为test节点
<ol><li><code>returnFiber</code>的<code>firstEffect</code>为null，<code>returnFiber.firstEffect = completedWork.firstEffect</code>，completedWork.firstEffect === null，所以赋值完成后<code>returnFiber.firstEffect</code> === null</li> <li><code>returnFiber.firstEffect = completedWork</code></li> <li><code>returnFiber.lastEffect = completedWork</code></li></ol></li></ul> <br> <p>​	<img src="/react-docs/assets/img/effect-list-demo1.cc5cac87.png"></p> <br> <ul><li>button 节点 complete，此时<code>returnFiber</code>为test节点
<ol><li><code>returnFiber.lastEffect.nextEffect = completedWork</code>，也就是说，p.nextEffect = button</li> <li><code>returnFiber.lastEffect = completedWork</code>，texst.lastEffect = button</li></ol></li></ul> <br> <p>​	<img src="/react-docs/assets/img/effect-list-demo2.c1a64f7b.png"></p> <br> <ul><li>test 节点 complete，此时<code>returnFiber</code>为div节点
<ol><li><code>returnFiber.firstEffect = completedWork.firstEffect</code>，即：div.firstEffect= p</li> <li><code>returnFiber.lastEffect = completedWork.lastEffect</code>,  即：div.lastEffect = button</li> <li><code>returnFiber.lastEffect.nextEffect = completedWork</code>，即：button.next = test</li> <li>returnFiber.lastEffect = completedWork，即：div.lastEffect = test</li></ol></li></ul> <br> <p>​	<img src="/react-docs/assets/img/effect-list-demo3.df0c4aec.png"></p> <br> <ul><li>div 节点 complete，此时<code>returnFiber</code>为app节点
<ol><li><code>returnFiber.firstEffect = completedWork.firstEffect</code>，即：app.firstEffect= p</li> <li><code>returnFiber.lastEffect = completedWork.lastEffect</code>，即：app.lastEffect = test</li> <li><code>returnFiber.lastEffect.nextEffect = completedWork</code>，即：test.next = div</li> <li><code>returnFiber.lastEffect = completedWork</code>，即：app.lastEffect= div</li></ol></li></ul> <br> <p>​	<img src="/react-docs/assets/img/effect-list-demo4.54b73392.png"></p> <br> <h2 id="总结-2"><a href="#总结-2" class="header-anchor">#</a> 总结</h2> <p>至此我们在commit阶段的工作全部完成，有上述effectList可以看出，firstEffect节点为P节点，也就是说，在commit阶段的更新是从下向上的更新（简而言之，子组件的<code>componentDidUpdate</code>生命周期比父组件早调用）。</p> <p>下一章我们进行遗留问题，diff算法的学习</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">6/19/2021, 6:19:48 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/react-docs/render/capture.html" class="prev">
        捕获阶段
      </a></span> <span class="next"><a href="/react-docs/commit/commit.html">
        commit 阶段
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/react-docs/assets/js/app.8dcc01f4.js" defer></script><script src="/react-docs/assets/js/2.ba3186f0.js" defer></script><script src="/react-docs/assets/js/3.3c0ce97a.js" defer></script>
  </body>
</html>
